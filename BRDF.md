这里主要整理一下漫反射部分的物理模型实现

一些基本公式：
snell法则
反射和折射的比例由菲涅尔方程给出，实际在图形学里一般使用近似公式

**光线的折射和反射**  
*一部分反射光线，还有另一部分发生折射，不同的物质对折射的处理不同*     
1.对于玻璃这些透明物质来说，光穿透玻璃，在另一边再次发生反射折射。  
2.对于不透明或者是半透明的物质  
2.1金属会将光线吸收，所以不会发生diffuse  
2.2绝缘体往往不是由单一成分构成，可以认为包含许多折射率不同的微粒，
会发生次表面散射现象。

**双向反射分布函数**  
*为了模拟非光学平面的散射，人们建立了各种模型，主要有以下几类*  
1.测量模型  
通过测量上百种真实材质表面在不同光照角度和观察角度下的反射数据，并记录下来  
2.经验模型
例如phong reflection model，blinn-phong model(不能很好模拟金属，因为金属不存在漫反射)  
3.基于物理的分析模型  
cook-torrance  

**辐射度学**
1.能量，Q单位焦耳  
2.功率，单位瓦特，亦或焦耳/秒    辐射功率也被称为辐射通量(radiant flux),指单位时间内通过表面或则空间区域的能量的总量  
3.辐照度和幅出度  
辐照度，指单位时间内到达单位面积的辐射能量，用E表示  
幅出度，指的是离开表面的通量密度，用M表示  
同时要注意表面朝向和光线方向的角度，通量密度与距离的平方成反比  
4.辐射强度
立体角：用ω表示，是三维角的度量，单位为立体弧度，等于立体角在单位球上对应的区域的面积  
辐射强度：通过立体单位角的辐射通量，用I表示，可以用来度量通过一个点的通量的密度  
5.辐射率  
指每单位面积每立体角的辐射通量密度，用L表示，辐射率不会随距离变化而衰减

辐照度会随着距离的增加而衰减，为什么我们看到的物体的颜色不会衰减呢，这是因为虽然通量密度会变小，但是立体角也会变小，刚好抵消了通量密度的变化。  

**BRDF**  
我们看到一个表面，实际上是环境光照射到表面上，然后表面将一部分光反射到我们眼睛里。对于一个方向的入射光，表面会将光反射到表面上半球的各个方向，  
brdf表示指定方向的反射光和入射光的比例关系，定义为dL(v)/dE(l).  
其中l是入射光方向，v是观察方向即反射光方向;  
dL(v)是表面反射到v方向的反射光的微分辐射率，L(v)表示来自于表面上半球所有方向的入射光线的贡献，微分辐射率特指来之于方向L的入射光的贡献  
dE(l)是表面上来自入射光方向l的微分辐射度，表面接收到的辐照度为E(l)，来自上半球所有方向的入射光的贡献，微分辐照度dE(l)特指来自于方向l的入射光  

**BRDF的表示**  
为了方便处理表面上半球的各个方向，使用球坐标定义方向更便捷，所以BRDF可以表示为f(θi，Φi，θ0，Φ0)，当物体各向同性时，可以简化为f(θi，theta0，Φ)，φ代表在入射光和反射光在投影平面点夹角  
总之BRDF提供了一系列可以模拟出漫反射的系数，实际上是由更进一步的模型模拟出来的

**微表面理论与cook-torrance模型**  
该理论认为我们看到的表面上的一点是由很多朝向各异且光学平的微小表面组成，所以只有法线朝向正好是l和v的半角向量h的微表面才会将光线发射到v方向，从而被看见  
使用法线分布函数(NDF)来描述组成表面一点的所有微表面的法线分布概率D(h
实际上由于入射光和反射光不一定能够到达眼睛，用几何衰减因子G(l,v)来建模，输入入射和出射光的方向，输出值表示光线未被遮蔽的比例  
还有光学平面并不会将所有光线都反射掉，而是一部分被反射，一部分被折射，反射比例符合菲涅尔方程F(l,h)  
最终的brdf模型:  
f(l,v)=F(l,h)G(l,v)D(h)/4cosθ<sub>i</sub>cosθ<sub>0</sub>
